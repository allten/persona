<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>Document</title>
    </head>
    <body>
        <h1>websocket chat</h1>
        <input type="text" id="chatname" value=" name"/>
        <input type="text" id="msg" value=" message"/>
        <button id="sendBtn">send</button>
        <ul id="rcv"></ul>
    </body>

    <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
    <script type="text/javascript">
        var host = "ws://localhost:8080/pipe";
        var ws = new WebSocket(host);
        var log = console.log.bind(console);

        // ws.on('connection', function(ws){
        //      ws.on('message)', function(message){
        //         console.log("received: %s", message);
        //         ws.broadcast(message);
        //     });
        // });

        ws.onmessage = function(message){
            var message_data = JSON.parse(message.data);
            var time = message_data['time'];
            var message = message_data['message'];
            var chatname = message_data['chatname'];
            var string_txt = "[" + time + "] - " + message + ":" + chatname
            
            $("#rcv").append("<li>" + string_txt + "</li>")
            console.log(ws);
        };


        $("#sendBtn").on("click",function(){
            chatname = $("#chatname").val()
            message = $("#msg").val()
            
            ws.send(chatname);
            ws.send(message);
            console.log(ws);
        });
    </script>
</html>